<!DOCTYPE html>
<html lang="en">
  <%- include('./components/head') %>
  <body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('active')">
        <i class="mdi mdi-menu"></i>
    </button>

    <div class="container-scroller">
      <!-- Sidebar -->
      <%- include('./components/sidebar') %>
      
      <!-- Main Content -->
      <div class="page-body-wrapper">
        <div class="main-panel">
          <div class="content-wrapper">

            <!-- Header Section -->
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-5">
                <div>
                    <h2 class="mb-1" style="font-weight: 700; letter-spacing: -0.025em; font-size: 1.8rem;">Dashboard</h2>
                    <p class="text-gray mb-0">Welcome back, <%= userinfo.username %>.</p>
                </div>
                <div class="mt-3 mt-md-0">
                    <span class="badge" style="background: var(--muted); border: 1px solid var(--border); color: var(--card-foreground); padding: 0.5rem 1rem; font-weight: 500;">
                        <i class="mdi mdi-calendar-blank mr-1"></i> <%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                    </span>
                </div>
            </div>

            <%- include('./components/alert') %>
            
            <!-- Alerts -->
            <% if (req.query.err == "ALREADY_OPEN") { %>
                <div class="alert fade show mb-4" role="alert" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #f87171; border-radius: var(--radius);">
                	<div class="d-flex align-items-center">
                        <i class="mdi mdi-alert-circle mr-2" style="font-size: 1.25rem;"></i>
                        <span>You can't open multiple tabs!</span>
                    </div>
            	</div>
            <% } else if (req.query.err === "CANNOTAFFORDRENEWAL") { %>
              <div class="alert fade show mb-4" role="alert" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); color: #93c5fd; border-radius: var(--radius);">
                <div class="d-flex align-items-center">
                    <i class="mdi mdi-information mr-2" style="font-size: 1.25rem;"></i>
                    <span>You need at least <strong><%= settings.renewals.cost %></strong> coins to renew this server.</span>
                </div>
            </div>
            <% } if (req.query.success === 'RENEWED') { %>
              <div class="alert fade show mb-4" role="alert" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); color: #34d399; border-radius: var(--radius);">
                <div class="d-flex align-items-center">
                    <i class="mdi mdi-check-circle mr-2" style="font-size: 1.25rem;"></i>
                    <span>Server renewal successful!</span>
                </div>
            </div>
            <% } if (req.session.newaccount || req.session.password) { %>
            <div class="alert fade show mb-4" role="alert" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); color: #93c5fd; border-radius: var(--radius);">
                <% if (req.session.newaccount) { %>
                    <h4 class="alert-heading" style="color: inherit; font-size: 1.1rem; font-weight: 600;"><i class="mdi mdi-party-popper mr-2"></i>Welcome Aboard!</h4>
                    <p class="mb-2">Your account has been created successfully.</p>
                <% } %>
                <% if (req.session.password) { %>
                    <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: var(--radius); margin-top: 0.5rem;">
                        <p class="mb-1 text-sm op-8">Your generated password is:</p>
                        <code style="font-size: 1.2rem; font-weight: 700; color: #fff; display: block; margin-bottom: 0.5rem;"><%= req.session.password %></code>
                        <p class="mb-0 text-sm op-8">Please save this immediately or change it in Settings.</p>
                    </div>
                <% } else { %>
                    <p class="mb-0">Please head over to <a href="/settings" style="color: inherit; text-decoration: underline;">Settings</a> to create a password.</p>
                <% } %>
            </div>
            <% } %>

            <!-- Resource Stats Grid -->
            <div class="mb-5">
                <h4 class="mb-3" style="font-size: 1rem; font-weight: 600; color: var(--muted-foreground); text-transform: uppercase; letter-spacing: 0.05em;">Resource Overview</h4>
                <%- include('./components/status') %>
            </div>

            <!-- Active Servers List (Replaces Quick Actions) -->
            <div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0" style="font-size: 1rem; font-weight: 600; color: var(--muted-foreground); text-transform: uppercase; letter-spacing: 0.05em;">Your Servers</h4>
                    <a href="../servers" class="btn btn-sm btn-outline-secondary" style="font-size: 0.8rem;">View All</a>
                </div>
                
                <div class="card" style="border: 1px solid var(--border);">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover" style="color: var(--card-foreground);">
                                <thead style="background: #18181b; color: var(--muted-foreground); font-size: 0.85rem; text-transform: uppercase;">
                                    <tr>
                                        <th style="border-bottom: 1px solid var(--border); padding: 1rem;">Server Name</th>
                                        <th style="border-bottom: 1px solid var(--border); padding: 1rem;">Identifier</th>
                                        <th style="border-bottom: 1px solid var(--border); padding: 1rem;">Resources (RAM / Disk / CPU)</th>
                                        <th style="border-bottom: 1px solid var(--border); padding: 1rem; text-align: right;">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (pterodactyl.relationships.servers.data.length == 0) { %>
                                        <tr>
                                            <td colspan="4" class="text-center py-5">
                                                <div class="d-flex flex-column align-items-center justify-content-center">
                                                    <i class="mdi mdi-server-off" style="font-size: 2rem; color: var(--muted-foreground); margin-bottom: 1rem;"></i>
                                                    <p class="text-muted mb-3">You don't have any servers yet.</p>
                                                    <a href="../servers/new" class="btn btn-primary btn-sm">Create Server</a>
                                                </div>
                                            </td>
                                        </tr>
                                    <% } else { %>
                                        <% for (let i = 0, len = Math.min(pterodactyl.relationships.servers.data.length, 5); i < len; i++) { %>
                                            <tr style="border-bottom: 1px solid var(--border);">
                                                <td style="padding: 1rem; vertical-align: middle;">
                                                    <div class="font-weight-bold"><%= pterodactyl.relationships.servers.data[i].attributes.name.length > 25 ? pterodactyl.relationships.servers.data[i].attributes.name.slice(0, 25) + "..." : pterodactyl.relationships.servers.data[i].attributes.name %></div>
                                                </td>
                                                <td style="padding: 1rem; vertical-align: middle;">
                                                    <code style="background: var(--muted); padding: 4px 8px; border-radius: 4px; color: var(--card-foreground);"><%= pterodactyl.relationships.servers.data[i].attributes.identifier %></code>
                                                </td>
                                                <td style="padding: 1rem; vertical-align: middle;">
                                                    <div class="d-flex align-items-center gap-3" style="gap: 15px;">
                                                        <span title="RAM"><i class="mdi mdi-memory mr-1 text-muted"></i><%= pterodactyl.relationships.servers.data[i].attributes.limits.memory/1024 %>GB</span>
                                                        <span title="Disk"><i class="mdi mdi-harddisk mr-1 text-muted"></i><%= pterodactyl.relationships.servers.data[i].attributes.limits.disk/1024 %>GB</span>
                                                        <span title="CPU"><i class="mdi mdi-cpu-64-bit mr-1 text-muted"></i><%= pterodactyl.relationships.servers.data[i].attributes.limits.cpu/100 %>C</span>
                                                    </div>
                                                </td>
                                                <td style="padding: 1rem; vertical-align: middle; text-align: right;">
                                                    <a href="<%= settings.pterodactyl.domain %>/server/<%= pterodactyl.relationships.servers.data[i].attributes.identifier %>" target="_blank" class="btn btn-sm btn-primary" style="padding: 0.4rem 0.8rem;">
                                                        Manage <i class="mdi mdi-open-in-new ml-1"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        <% } %>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

          </div>
          <!-- content-wrapper ends -->
          <%- include('./components/footer') %>
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <%- include('./components/scripts') %>
    
    <style>
        .table td {
            border-top: none !important;
            border-bottom: 1px solid var(--border);
            color: var(--card-foreground); /* Default text color */
        }
        .table tr:last-child td {
            border-bottom: none;
        }
        
        /* Hover State Fix */
        .table-hover tbody tr:hover {
            background-color: #18181b;
        }
        
        .table-hover tbody tr:hover td {
            color: #ffffff; /* Ensure text stays white on hover */
        }
        
        /* Ensure muted text stays muted but readable on hover */
        .table-hover tbody tr:hover .text-muted {
            color: #a1a1aa !important;
        }
        
        /* Ensure icon colors persist */
        .table-hover tbody tr:hover i {
            color: inherit;
        }
    </style>
  </body>
</html>
