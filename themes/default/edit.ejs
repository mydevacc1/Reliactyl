<!DOCTYPE html>
<html lang="en">
  <%- include('./components/head') %>
  <body>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('active')">
        <i class="mdi mdi-menu"></i>
    </button>

    <div class="container-scroller">
      <!-- partial:partials/_sidebar.html -->
      <%- include('./components/sidebar') %>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">

           <!-- Header -->
           <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
                <div>
                    <h2 class="mb-1" style="font-weight: 700; letter-spacing: -0.025em; font-size: 1.8rem;">Edit Server</h2>
                    <p class="text-gray mb-0">Modify resources for your server instance.</p>
                </div>
            </div>

            <% if (req.query.err) { %>
            <div class="alert fade show mb-4" role="alert" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #f87171; border-radius: var(--radius);">
                <div class="d-flex align-items-center">
                    <i class="mdi mdi-alert-circle mr-2" style="font-size: 1.25rem;"></i>
                    <span>
                        <% if (req.query.err == "MISSINGVARIABLE") { %>
                            You have not filled out all of the server information.
                        <% } else if (req.query.err == "ERRORONMODIFY") { %>
                            There has been an error while attempting to modifying your server. Please alert an administrator to fix this problem.
                        <% } else if (req.query.err == "MISSINGEGG") { %>
                            The server type for this server is not registered as a valid server type, therefore your server's RAM, disk and/or CPU could not be changed.
                        <% } else if (req.query.err == "MUSTCOMPLETECAPTCHA") { %>
                          You must complete the captcha to prove you are human!
                        <% } else if (req.query.err == "INVALIDCAPTCHARESPONSE") { %>
                          You submitted an invalid captcha response, try again.
                        <% } else { %>
                            <% if (req.query.num) { %>
                                <% if (!isNaN(parseFloat(req.query.num))) { %>
                                    <% if (req.query.err == "TOOLITTLERAM" || req.query.err == "TOOLITTLEDISK" || req.query.err == "TOOLITTLECPU") { %>
                                        You must make a server with at least <b><%= req.query.num %></b>
                                        <% if (req.query.err.slice(-3) == "RAM") { %>
                                            MB RAM
                                        <% } else if (req.query.err.slice(-4) == "DISK") { %>
                                            MB disk
                                        <% } else { // CPU %>
                                            % CPU
                                        <% } %>
                                        if you want to modified a server with the server type you have selected.
                                    <% } else if (req.query.err == "TOOMUCHRAM" || req.query.err == "TOOMUCHDISK" || req.query.err == "TOOMUCHCPU") { %>
                                        With the selected server type, you can have a maximum of <b><%= req.query.num %></b>
                                        <% if (req.query.err.slice(-3) == "RAM") { %>
                                            MB RAM
                                        <% } else if (req.query.err.slice(-4) == "DISK") { %>
                                            MB disk
                                        <% } else { // CPU %>
                                            % CPU
                                        <% } %>
                                        on the server.
                                    <% } else if (req.query.err == "EXCEEDRAM" || req.query.err == "EXCEEDDISK" || req.query.err == "EXCEEDCPU") { %>
                                        The server could not be modified because you have requested to modified a server that exceeds your plan.
                                    <% } else { %>
                                        Unknown error.
                                    <% } %>
                                <% } else { %>
                                    Unknown error.
                                <% } %>
                            <% } else { %>
                                Unknown error.
                            <% } %>
                        <% } %>
                    </span>
                </div>
            </div>
        <% } %>

        <% if (req.query.id) { %>
            <% if (pterodactyl.relationships.servers.data.filter(name => name.attributes.id == req.query.id).length == 1) {
                let serverinfo = pterodactyl.relationships.servers.data.filter(name => name.attributes.id == req.query.id)[0];
                let attemptegg = null;
                let attemptname = null;
                for (let [name, value] of Object.entries(settings.api.client.eggs)) {
                    if (settings.api.client.eggs[name].info.egg == serverinfo.attributes.egg) {
                        attemptegg = settings.api.client.eggs[name];
                        attemptname = name;
                    };
                };
                let egginfo = attemptegg ? attemptegg.display : "???";
            %>
            <div class="row">
              <div class="col-md-8 grid-margin stretch-card mx-auto">
                <div class="card" style="border: 1px solid var(--border);">
                  <div class="card-body">
                    <form class="forms-sample">
                      <div class="form-group mb-4">
                        <label for="exampleInputUsername1" style="color: var(--muted-foreground); font-weight: 500;">Server Name</label>
                        <input type="text" class="form-control" value="<%= serverinfo.attributes.name %> (Managed in Panel)" disabled style="background: var(--muted); border-color: var(--border); color: var(--muted-foreground); opacity: 0.7;">
                      </div>
                      
                      <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-4">
                                <label for="InputCPU" style="color: var(--muted-foreground); font-weight: 500;">CPU (Cores)</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" style="background: var(--muted); border-color: var(--border); color: var(--muted-foreground);"><i class="mdi mdi-cpu-64-bit"></i></span>
                                    </div>
                                    <input type="number" class="form-control" id="InputCPU" placeholder="1" value="<%= serverinfo.attributes.limits.cpu/100 %>" style="background: var(--background); border-color: var(--border); color: var(--card-foreground);">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-4">
                                <label for="InputRAM" style="color: var(--muted-foreground); font-weight: 500;">RAM (GBs)</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" style="background: var(--muted); border-color: var(--border); color: var(--muted-foreground);"><i class="mdi mdi-memory"></i></span>
                                    </div>
                                    <input type="number" class="form-control" id="InputRAM" placeholder="2" value="<%= serverinfo.attributes.limits.memory/1024 %>" style="background: var(--background); border-color: var(--border); color: var(--card-foreground);">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-4">
                                <label for="InputDisk" style="color: var(--muted-foreground); font-weight: 500;">Disk (GBs)</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" style="background: var(--muted); border-color: var(--border); color: var(--muted-foreground);"><i class="mdi mdi-harddisk"></i></span>
                                    </div>
                                    <input type="number" class="form-control" id="InputDisk" placeholder="5" value="<%= serverinfo.attributes.limits.disk/1024 %>" style="background: var(--background); border-color: var(--border); color: var(--card-foreground);">
                                </div>
                            </div>
                        </div>
                      </div>

                      <div class="form-group mb-4">
                        <label for="InputEgg" style="color: var(--muted-foreground); font-weight: 500;">Software / Egg</label>
                        <select class="form-control" disabled style="background: var(--muted); border-color: var(--border); color: var(--muted-foreground); opacity: 0.7;">
                          <% for (let [name, value] of Object.entries(settings.api.client.eggs)) { %>
                            <option value="<%= name %>" <%= name === attemptname ? 'selected' : '' %>><%= value.display %></option>
                          <% } %>
                        </select>
                        <small class="form-text text-muted mt-2"><i class="mdi mdi-information-outline"></i> The software type cannot be changed after creation.</small>
                      </div>

                      <div class="d-flex justify-content-end mt-4">
                        <a href="../servers" class="btn btn-secondary mr-2" style="background: transparent; border: 1px solid var(--border); color: var(--card-foreground);">Cancel</a>
                        <a role="button" class="btn btn-primary" href="javascript: submitChanges()"><i class="mdi mdi-content-save mr-2"></i>Apply Changes</a>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
         
          <% } else { %>
                <div class="row">
                    <div class="col-12 text-center py-5">
                        <i class="mdi mdi-alert-circle-outline" style="font-size: 3rem; color: var(--muted-foreground);"></i>
                        <p class="mt-3">Could not find server with the provided ID.</p>
                        <a href="../servers" class="btn btn-primary btn-sm mt-2">Back to Servers</a>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="row">
                <div class="col-12 text-center py-5">
                    <i class="mdi mdi-alert-circle-outline" style="font-size: 3rem; color: var(--muted-foreground);"></i>
                    <p class="mt-3">Missing server ID.</p>
                    <a href="../servers" class="btn btn-primary btn-sm mt-2">Back to Servers</a>
                </div>
            </div>
        <% } %>
          </div>
          <!-- content-wrapper ends -->
          <%- include('./components/footer') %>
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- Plugin js for this page -->
    <script src="/assets/vendors/select2/select2.min.js"></script>
    <script src="/assets/vendors/typeahead.js/typeahead.bundle.min.js"></script>
    <script>
      async function submitChanges() {
        let ram = encodeURIComponent(document.getElementById("InputRAM").value * 1024);
        let disk = encodeURIComponent(document.getElementById("InputDisk").value * 1024);
        let cpu = encodeURIComponent(document.getElementById("InputCPU").value * 100);
        document.location.href = `/modify?id=<%= req.query.id %>&ram=${ram}&disk=${disk}&cpu=${cpu}`;
      };
    </script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <%- include('./components/scripts') %>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="/assets/js/file-upload.js"></script>
    <script src="/assets/js/typeahead.js"></script>
    <script src="/assets/js/select2.js"></script>
    
    <style>
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
            color: var(--card-foreground);
        }
        
        .input-group-text {
            border: 1px solid var(--border);
        }
        
        .form-control {
            border: 1px solid var(--border);
        }
    </style>
  </body>
</html>